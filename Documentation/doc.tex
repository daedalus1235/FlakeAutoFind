\documentclass{article}
\usepackage{hw}

\title{FlakeAutoFind}
\author{Charles Yang}
\date{Last updates: \today}

\begin{document}
\maketitle
\setcounter{tocdepth}{1}
\tableofcontents

\section{General Algorithm}
The image is flattened using an infered background level. After flattening, morphological transformations are applied. Opening reduces the amount of small, white pixels, eroding reduces the size of bigger clumps of white pixels, and closing makes the flakes more solid and bold. 

\section{Flattening}
The symmetry of the background is assumed to that of an ellipse. Similar to a circle, where the radius is defined
\[s^2=(x-x_c)^2+(y-y_c)^2\]
we define a distance coordinate
\[s^2=(x-x_c)^2+r^2(y-y_c)^2\]
where \(r\) is the aspect ratio of the ellipse, given
\[r = \frac{\text{width}}{\text{height}}\]

In this way, we consider the background to be a function of the elliptical distance. To maintain smoothness, the background is modeled as the sum of even terms:
\[B_N(s)=\sum_{n=0}^N a_ns^{2n}\]

Clearly, the first \(n\) coefficients can be solved for using a system of linear equations generated by \(n\) samples of the background. This yields the equation
\[B = SA\]
where \(B\) is a vector of background values, \(A\) is a vector of the coefficients, and \(S\) is the Vandermonde matrix of the values \(s_i^2\).



Once the coefficients are determined, the equation can be determined recursively as:
\[f_0=a_N\]
\[f_{n} =s^2f_{n-1} +a_{N-n}\]
with
\[B_N(s)=f_N\]
Unfortunately, only considering the lowest order (\(s^2\)) leads to inaccuracy around the borders of the image. 
\end{document}
